#!/bin/bash
"""
ğŸš€ Three.js Evolution Registry - ä¸€é”®éƒ¨ç½²è„šæœ¬

Usage:
    chmod +x deploy.sh
    ./deploy.sh
"""

set -e

echo "ğŸ¦ OpenClaw Evolution Registry - éƒ¨ç½²è„šæœ¬"
echo "============================================"
echo ""

# æ£€æŸ¥ Git é…ç½®
if ! git config user.email &>/dev/null; then
    echo "ğŸ“ é…ç½® Git ç”¨æˆ·ä¿¡æ¯..."
    git config user.email "openclaw@example.com"
    git config user.name "OpenClaw Bot"
fi

# æ£€æŸ¥æ˜¯å¦åœ¨æ­£ç¡®çš„ç›®å½•
if [ ! -f "index.html" ]; then
    echo "âŒ é”™è¯¯: æ‰¾ä¸åˆ° index.htmlï¼Œè¯·ç¡®ä¿åœ¨æ­£ç¡®çš„ç›®å½•è¿è¡Œ"
    exit 1
fi

# è¯»å– GitHub ç”¨æˆ·å
read -p "ğŸ‘¤ è¯·è¾“å…¥ä½ çš„ GitHub ç”¨æˆ·å: " GITHUB_USER

if [ -z "$GITHUB_USER" ]; then
    echo "âŒ é”™è¯¯: ç”¨æˆ·åä¸èƒ½ä¸ºç©º"
    exit 1
fi

echo ""
echo "ğŸ”§ å‡†å¤‡éƒ¨ç½²..."
echo "ğŸ“¦ ç”¨æˆ·å: $GITHUB_USER"
echo ""

# 1. åˆå§‹åŒ–/æ›´æ–° Git
echo "ğŸ“ åˆå§‹åŒ– Git ä»“åº“..."
if [ ! -d ".git" ]; then
    git init -q
    git config user.email "openclaw@example.com"
    git config user.name "OpenClaw Bot"
fi

# 2. æ·»åŠ æ‰€æœ‰æ–‡ä»¶
echo "ğŸ“¦ æ·»åŠ æ–‡ä»¶åˆ° Git..."
git add -A

# 3. æäº¤
echo "ğŸ’¾ åˆ›å»ºæäº¤..."
COMMIT_MSG=$(cat <<EOF
ğŸ¦ OpenClaw Evolution Registry - $(date +%Y-%m-%d)

ğŸ¯ åŠŸèƒ½:
- Three.js åŸºç¡€åŸºå› 
- è¿›åŒ–è¿½è¸ªç³»ç»Ÿ
- GitHub Pages è‡ªåŠ¨éƒ¨ç½²
- ç°ä»£åŒ– Web UI

ğŸ¤– Auto-generated by OpenClaw
EOF
)
git commit -q -m "$COMMIT_MSG"

# 4. é‡å‘½ååˆ†æ”¯
echo "ğŸ”€ é‡å‘½ååˆ†æ”¯ä¸º main..."
git branch -M main 2>/dev/null || true

# 5. åˆ›å»º GitHub ä»“åº“
echo ""
echo "ğŸ“¦ åˆ›å»º GitHub ä»“åº“..."
gh repo create ThreeJSEvolution \
    --public \
    --description "OpenClaw Evolution Registry - Three.js èƒ½åŠ›è¿›åŒ–ç³»ç»Ÿ ğŸ¦ğŸ§¬" \
    --source=. \
    --push 2>/dev/null

if [ $? -ne 0 ]; then
    echo ""
    echo "âš ï¸ GitHub CLI ä¸å¯ç”¨ï¼Œå°†ä½¿ç”¨ SSH æ–¹å¼..."
    echo ""
    echo "ğŸ“ è¯·æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š"
    echo ""
    echo "1ï¸âƒ£  è®¿é—® https://github.com/new åˆ›å»ºåä¸º 'ThreeJSEvolution' çš„ä»“åº“"
    echo ""
    echo "2ï¸âƒ£  è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š"
    echo ""
    cat << 'CMDS'
git remote add origin git@github.com:USERNAME/ThreeJSEvolution.git
git push -u origin main
CMDS
    echo ""
    echo "3ï¸âƒ£  å¯ç”¨ GitHub Pages:"
    echo "   - è¿›å…¥ä»“åº“ Settings â†’ Pages"
    echo "   - Source é€‰æ‹© 'Deploy from a branch'"
    echo "   - Branch é€‰æ‹© 'main' /(root)"
    echo "   - ç‚¹å‡» Save"
    echo ""
    exit 0
fi

echo ""
echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo ""
echo "ğŸ‰ ä¸‹ä¸€æ­¥:"
echo ""
echo "1ï¸âƒ£  å¯ç”¨ GitHub Pages:"
echo "   è®¿é—® https://github.com/$GITHUB_USER/ThreeJSEvolution/settings/pages"
echo "   - Source: Deploy from a branch"
echo "   - Branch: main / (root)"
echo "   - ç‚¹å‡» Save"
echo ""
echo "2ï¸âƒ£  è®¿é—®ä½ çš„ç½‘ç«™:"
echo "   https://$GITHUB_USER.github.io/ThreeJSEvolution/"
echo ""
echo "3ï¸âƒ£  éªŒè¯éƒ¨ç½²:"
echo "   - æ‰“å¼€ä¸Šé¢çš„é“¾æ¥"
echo "   - åº”è¯¥èƒ½çœ‹åˆ° OpenClaw Evolution ä¸»é¡µ"
echo "   - ç‚¹å‡» 'ç«‹å³ä½“éªŒ' æµ‹è¯• Three.js æ¼”ç¤º"
echo ""
echo "ğŸ“Š GitHub ä»“åº“:"
echo "   https://github.com/$GITHUB_USER/ThreeJSEvolution"
echo ""
echo "ğŸ§¬ æŒç»­æ›´æ–°:"
echo "   - æ¯æ¬¡ push åˆ° main åˆ†æ”¯ä¼šè‡ªåŠ¨éƒ¨ç½²"
echo "   - è®¿é—®ä¸Šé¢çš„é“¾æ¥æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬"
echo ""
